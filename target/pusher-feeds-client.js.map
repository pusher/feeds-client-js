{"version":3,"file":"pusher-feeds-client.js","sources":["../node_modules/pusher-platform/dist/web/pusher-platform.js","../src/utils.js","../src/feed.js","../src/constants.js","../src/token-provider.js","../src/feeds.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"PusherPlatform\"] = factory();\n\telse\n\t\troot[\"PusherPlatform\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 9);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nfunction responseToHeadersObject(headerStr) {\n    var headers = {};\n    if (!headerStr) {\n        return headers;\n    }\n    var headerPairs = headerStr.split('\\u000d\\u000a');\n    for (var _i = 0, headerPairs_1 = headerPairs; _i < headerPairs_1.length; _i++) {\n        var headerPair = headerPairs_1[_i];\n        var index = headerPair.indexOf('\\u003a\\u0020');\n        if (index > 0) {\n            var key = headerPair.substring(0, index);\n            var val = headerPair.substring(index + 2);\n            headers[key] = val;\n        }\n    }\n    return headers;\n}\nexports.responseToHeadersObject = responseToHeadersObject;\nvar ErrorResponse = (function () {\n    function ErrorResponse(statusCode, headers, info) {\n        this.statusCode = statusCode;\n        this.headers = headers;\n        this.info = info;\n    }\n    ErrorResponse.fromXHR = function (xhr) {\n        return new ErrorResponse(xhr.status, responseToHeadersObject(xhr.getAllResponseHeaders()), xhr.responseText);\n    };\n    return ErrorResponse;\n}());\nexports.ErrorResponse = ErrorResponse;\nvar NetworkError = (function () {\n    function NetworkError(error) {\n        this.error = error;\n    }\n    return NetworkError;\n}());\nexports.NetworkError = NetworkError;\nvar XhrReadyState;\n(function (XhrReadyState) {\n    XhrReadyState[XhrReadyState[\"UNSENT\"] = 0] = \"UNSENT\";\n    XhrReadyState[XhrReadyState[\"OPENED\"] = 1] = \"OPENED\";\n    XhrReadyState[XhrReadyState[\"HEADERS_RECEIVED\"] = 2] = \"HEADERS_RECEIVED\";\n    XhrReadyState[XhrReadyState[\"LOADING\"] = 3] = \"LOADING\";\n    XhrReadyState[XhrReadyState[\"DONE\"] = 4] = \"DONE\";\n})(XhrReadyState = exports.XhrReadyState || (exports.XhrReadyState = {}));\n\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar LogLevel;\n(function (LogLevel) {\n    LogLevel[LogLevel[\"VERBOSE\"] = 1] = \"VERBOSE\";\n    LogLevel[LogLevel[\"DEBUG\"] = 2] = \"DEBUG\";\n    LogLevel[LogLevel[\"INFO\"] = 3] = \"INFO\";\n    LogLevel[LogLevel[\"WARNING\"] = 4] = \"WARNING\";\n    LogLevel[LogLevel[\"ERROR\"] = 5] = \"ERROR\";\n})(LogLevel = exports.LogLevel || (exports.LogLevel = {}));\nvar ConsoleLogger = (function () {\n    function ConsoleLogger(threshold) {\n        if (threshold === void 0) { threshold = 2; }\n        this.threshold = threshold;\n        var groups = Array();\n        var hr = '--------------------------------------------------------------------------------';\n        if (!window.console.group) {\n            window.console.group = function (label) {\n                groups.push(label);\n                window.console.log('%c \\nBEGIN GROUP: %c', hr, label);\n            };\n        }\n        if (!window.console.groupEnd) {\n            window.console.groupEnd = function () {\n                window.console.log('END GROUP: %c\\n%c', groups.pop(), hr);\n            };\n        }\n    }\n    ConsoleLogger.prototype.verbose = function (message, error) {\n        this.log(window.console.log, LogLevel.VERBOSE, message, error);\n    };\n    ConsoleLogger.prototype.debug = function (message, error) {\n        this.log(window.console.log, LogLevel.DEBUG, message, error);\n    };\n    ConsoleLogger.prototype.info = function (message, error) {\n        this.log(window.console.info, LogLevel.INFO, message, error);\n    };\n    ConsoleLogger.prototype.warn = function (message, error) {\n        this.log(window.console.warn, LogLevel.WARNING, message, error);\n    };\n    ConsoleLogger.prototype.error = function (message, error) {\n        this.log(window.console.error, LogLevel.ERROR, message, error);\n    };\n    ConsoleLogger.prototype.log = function (logFunction, level, message, error) {\n        if (level >= this.threshold) {\n            var loggerSignature = \"Logger.\" + LogLevel[level];\n            if (error) {\n                window.console.group();\n                logFunction(loggerSignature + \": \" + message);\n                logFunction(error);\n                window.console.groupEnd();\n            }\n            else {\n                logFunction(loggerSignature + \": \" + message);\n            }\n        }\n    };\n    return ConsoleLogger;\n}());\nexports.ConsoleLogger = ConsoleLogger;\nvar EmptyLogger = (function () {\n    function EmptyLogger() {\n    }\n    EmptyLogger.prototype.verbose = function (message, error) { };\n    EmptyLogger.prototype.debug = function (message, error) { };\n    EmptyLogger.prototype.info = function (message, error) { };\n    EmptyLogger.prototype.warn = function (message, error) { };\n    EmptyLogger.prototype.error = function (message, error) { };\n    return EmptyLogger;\n}());\nexports.EmptyLogger = EmptyLogger;\n\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar network_1 = __webpack_require__(0);\nexports.createRetryStrategyOptionsOrDefault = function (options) {\n    var initialTimeoutMillis = options.initialTimeoutMillis || 1000;\n    var maxTimeoutMillis = options.maxTimeoutMillis || 5000;\n    var limit = -1;\n    if (options.limit !== undefined && options.limit != null) {\n        limit = options.limit;\n    }\n    var increaseTimeout;\n    if (options.increaseTimeout !== undefined) {\n        increaseTimeout = options.increaseTimeout;\n    }\n    else {\n        increaseTimeout = function (currentTimeout) {\n            if (currentTimeout * 2 > maxTimeoutMillis) {\n                return maxTimeoutMillis;\n            }\n            else {\n                return currentTimeout * 2;\n            }\n        };\n    }\n    return {\n        increaseTimeout: increaseTimeout,\n        initialTimeoutMillis: initialTimeoutMillis,\n        limit: limit,\n        maxTimeoutMillis: maxTimeoutMillis,\n    };\n};\nvar Retry = (function () {\n    function Retry(waitTimeMillis) {\n        this.waitTimeMillis = waitTimeMillis;\n    }\n    return Retry;\n}());\nexports.Retry = Retry;\nvar DoNotRetry = (function () {\n    function DoNotRetry(error) {\n        this.error = error;\n    }\n    return DoNotRetry;\n}());\nexports.DoNotRetry = DoNotRetry;\nvar requestMethodIsSafe = function (method) {\n    method = method.toUpperCase();\n    return (method === 'GET' ||\n        method === 'HEAD' ||\n        method === 'OPTIONS' ||\n        method === 'SUBSCRIBE');\n};\nvar RetryResolution = (function () {\n    function RetryResolution(options, logger, retryUnsafeRequests) {\n        this.options = options;\n        this.logger = logger;\n        this.retryUnsafeRequests = retryUnsafeRequests;\n        this.currentRetryCount = 0;\n        this.initialTimeoutMillis = options.initialTimeoutMillis;\n        this.maxTimeoutMillis = options.maxTimeoutMillis;\n        this.limit = options.limit;\n        this.increaseTimeoutFunction = options.increaseTimeout;\n        this.currentBackoffMillis = this.initialTimeoutMillis;\n    }\n    RetryResolution.prototype.attemptRetry = function (error) {\n        this.logger.verbose(this.constructor.name + \":  Error received\", error);\n        if (this.currentRetryCount >= this.limit && this.limit >= 0) {\n            this.logger.verbose(this.constructor.name + \":  Retry count is over the maximum limit: \" + this.limit);\n            return new DoNotRetry(error);\n        }\n        if (error instanceof network_1.ErrorResponse && error.headers['Retry-After']) {\n            this.logger.verbose(this.constructor.name + \":  Retry-After header is present, retrying in \" + error.headers['Retry-After']);\n            return new Retry(parseInt(error.headers['Retry-After'], 10) * 1000);\n        }\n        if (error instanceof network_1.NetworkError ||\n            (error instanceof network_1.ErrorResponse &&\n                requestMethodIsSafe(error.headers['Request-Method'])) ||\n            this.retryUnsafeRequests) {\n            return this.shouldSafeRetry(error);\n        }\n        if (error instanceof network_1.NetworkError) {\n            return this.shouldSafeRetry(error);\n        }\n        this.logger.verbose(this.constructor.name + \": Error is not retryable\", error);\n        return new DoNotRetry(error);\n    };\n    RetryResolution.prototype.shouldSafeRetry = function (error) {\n        if (error instanceof network_1.NetworkError) {\n            this.logger.verbose(this.constructor.name + \": It's a Network Error, will retry\", error);\n            return new Retry(this.calulateMillisToRetry());\n        }\n        else if (error instanceof network_1.ErrorResponse) {\n            if (error.statusCode >= 500 && error.statusCode < 600) {\n                this.logger.verbose(this.constructor.name + \": Error 5xx, will retry\");\n                return new Retry(this.calulateMillisToRetry());\n            }\n        }\n        this.logger.verbose(this.constructor.name + \": Error is not retryable\", error);\n        return new DoNotRetry(error);\n    };\n    RetryResolution.prototype.calulateMillisToRetry = function () {\n        this.currentBackoffMillis = this.increaseTimeoutFunction(this.currentBackoffMillis);\n        this.logger.verbose(this.constructor.name + \": Retrying in \" + this.currentBackoffMillis + \"ms\");\n        return this.currentBackoffMillis;\n    };\n    return RetryResolution;\n}());\nexports.RetryResolution = RetryResolution;\n\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar logger_1 = __webpack_require__(1);\nvar request_1 = __webpack_require__(4);\nvar resuming_subscription_1 = __webpack_require__(5);\nvar retrying_subscription_1 = __webpack_require__(6);\nvar subscribe_strategy_1 = __webpack_require__(10);\nvar subscription_1 = __webpack_require__(11);\nvar token_providing_subscription_1 = __webpack_require__(7);\nvar http_1 = __webpack_require__(12);\nvar websocket_1 = __webpack_require__(13);\nvar transports_1 = __webpack_require__(8);\nvar BaseClient = (function () {\n    function BaseClient(options) {\n        this.options = options;\n        this.host = options.host.replace(/(\\/)+$/, '');\n        this.logger = options.logger || new logger_1.ConsoleLogger();\n        this.websocketTransport = new websocket_1.default(this.host);\n        this.httpTransport = new http_1.default(this.host);\n    }\n    BaseClient.prototype.request = function (options, tokenParams) {\n        var _this = this;\n        if (options.tokenProvider) {\n            return options.tokenProvider\n                .fetchToken(tokenParams)\n                .then(function (token) {\n                if (options.headers !== undefined) {\n                    options.headers['Authorization'] = \"Bearer \" + token;\n                }\n                else {\n                    options.headers = (_a = {},\n                        _a['Authorization'] = \"Bearer \" + token,\n                        _a);\n                }\n                return request_1.executeNetworkRequest(function () { return _this.httpTransport.request(options); }, options);\n                var _a;\n            })\n                .catch(function (error) {\n                _this.logger.error(error);\n            });\n        }\n        return request_1.executeNetworkRequest(function () { return _this.httpTransport.request(options); }, options);\n    };\n    BaseClient.prototype.subscribeResuming = function (path, headers, listeners, retryStrategyOptions, initialEventId, tokenProvider) {\n        var completeListeners = subscription_1.replaceMissingListenersWithNoOps(listeners);\n        var subscribeStrategyListeners = subscribe_strategy_1.subscribeStrategyListenersFromSubscriptionListeners(completeListeners);\n        var subscriptionStrategy = resuming_subscription_1.createResumingStrategy(retryStrategyOptions, token_providing_subscription_1.createTokenProvidingStrategy(transports_1.createTransportStrategy(path, this.websocketTransport, this.logger), this.logger, tokenProvider), this.logger, initialEventId);\n        var opened = false;\n        return subscriptionStrategy({\n            onEnd: subscribeStrategyListeners.onEnd,\n            onError: subscribeStrategyListeners.onError,\n            onEvent: subscribeStrategyListeners.onEvent,\n            onOpen: function (headers) {\n                if (!opened) {\n                    opened = true;\n                    subscribeStrategyListeners.onOpen(headers);\n                }\n                completeListeners.onSubscribe();\n            },\n            onRetrying: subscribeStrategyListeners.onRetrying,\n        }, headers);\n    };\n    BaseClient.prototype.subscribeNonResuming = function (path, headers, listeners, retryStrategyOptions, tokenProvider) {\n        var completeListeners = subscription_1.replaceMissingListenersWithNoOps(listeners);\n        var subscribeStrategyListeners = subscribe_strategy_1.subscribeStrategyListenersFromSubscriptionListeners(completeListeners);\n        var subscriptionStrategy = retrying_subscription_1.createRetryingStrategy(retryStrategyOptions, token_providing_subscription_1.createTokenProvidingStrategy(transports_1.createTransportStrategy(path, this.websocketTransport, this.logger), this.logger, tokenProvider), this.logger);\n        var opened = false;\n        return subscriptionStrategy({\n            onEnd: subscribeStrategyListeners.onEnd,\n            onError: subscribeStrategyListeners.onError,\n            onEvent: subscribeStrategyListeners.onEvent,\n            onOpen: function (headers) {\n                if (!opened) {\n                    opened = true;\n                    subscribeStrategyListeners.onOpen(headers);\n                }\n                completeListeners.onSubscribe();\n            },\n            onRetrying: subscribeStrategyListeners.onRetrying,\n        }, headers);\n    };\n    return BaseClient;\n}());\nexports.BaseClient = BaseClient;\n\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar network_1 = __webpack_require__(0);\nfunction executeNetworkRequest(createXhr, options) {\n    return new Promise(function (resolve, reject) {\n        var xhr = createXhr();\n        xhr.onreadystatechange = function () {\n            if (xhr.readyState === 4) {\n                if (xhr.status >= 200 && xhr.status < 300) {\n                    resolve(xhr.response);\n                }\n                else if (xhr.status !== 0) {\n                    reject(network_1.ErrorResponse.fromXHR(xhr));\n                }\n                else {\n                    reject(new network_1.NetworkError('No Connection'));\n                }\n            }\n        };\n        xhr.send(JSON.stringify(options.body));\n    });\n}\nexports.executeNetworkRequest = executeNetworkRequest;\n\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar network_1 = __webpack_require__(0);\nvar retry_strategy_1 = __webpack_require__(2);\nexports.createResumingStrategy = function (retryOptions, nextSubscribeStrategy, logger, initialEventId) {\n    var completeRetryOptions = retry_strategy_1.createRetryStrategyOptionsOrDefault(retryOptions);\n    var retryResolution = new retry_strategy_1.RetryResolution(completeRetryOptions, logger);\n    var ResumingSubscription = (function () {\n        function ResumingSubscription(listeners, headers) {\n            var _this = this;\n            this.unsubscribe = function () {\n                _this.state.unsubscribe();\n            };\n            this.onTransition = function (newState) {\n                _this.state = newState;\n            };\n            var OpeningSubscriptionState = (function () {\n                function OpeningSubscriptionState(onTransition) {\n                    var _this = this;\n                    this.onTransition = onTransition;\n                    var lastEventId = initialEventId;\n                    logger.verbose(\"ResumingSubscription: transitioning to OpeningSubscriptionState\");\n                    if (lastEventId) {\n                        headers['Last-Event-Id'] = lastEventId;\n                        logger.verbose(\"ResumingSubscription: initialEventId is \" + lastEventId);\n                    }\n                    this.underlyingSubscription = nextSubscribeStrategy({\n                        onEnd: function (error) {\n                            onTransition(new EndedSubscriptionState(error));\n                        },\n                        onError: function (error) {\n                            onTransition(new ResumingSubscriptionState(error, onTransition, lastEventId));\n                        },\n                        onEvent: function (event) {\n                            lastEventId = event.eventId;\n                            listeners.onEvent(event);\n                        },\n                        onOpen: function (headers) {\n                            onTransition(new OpenSubscriptionState(headers, _this.underlyingSubscription, onTransition));\n                        },\n                        onRetrying: listeners.onRetrying,\n                    }, headers);\n                }\n                OpeningSubscriptionState.prototype.unsubscribe = function () {\n                    this.onTransition(new EndingSubscriptionState());\n                    this.underlyingSubscription.unsubscribe();\n                };\n                return OpeningSubscriptionState;\n            }());\n            var OpenSubscriptionState = (function () {\n                function OpenSubscriptionState(headers, underlyingSubscription, onTransition) {\n                    this.underlyingSubscription = underlyingSubscription;\n                    this.onTransition = onTransition;\n                    logger.verbose(\"ResumingSubscription: transitioning to OpenSubscriptionState\");\n                    listeners.onOpen(headers);\n                }\n                OpenSubscriptionState.prototype.unsubscribe = function () {\n                    this.onTransition(new EndingSubscriptionState());\n                    this.underlyingSubscription.unsubscribe();\n                };\n                return OpenSubscriptionState;\n            }());\n            var ResumingSubscriptionState = (function () {\n                function ResumingSubscriptionState(error, onTransition, lastEventId) {\n                    var _this = this;\n                    this.onTransition = onTransition;\n                    logger.verbose(\"ResumingSubscription: transitioning to ResumingSubscriptionState\");\n                    var executeSubscriptionOnce = function (error, lastEventId) {\n                        listeners.onRetrying();\n                        var resolveError = function (error) {\n                            if (error instanceof network_1.ErrorResponse) {\n                                error.headers['Request-Method'] = 'SUBSCRIBE';\n                            }\n                            return retryResolution.attemptRetry(error);\n                        };\n                        var errorResolution = resolveError(error);\n                        if (errorResolution instanceof retry_strategy_1.Retry) {\n                            _this.timeout = window.setTimeout(function () {\n                                executeNextSubscribeStrategy(lastEventId);\n                            }, errorResolution.waitTimeMillis);\n                        }\n                        else {\n                            onTransition(new FailedSubscriptionState(error));\n                        }\n                    };\n                    var executeNextSubscribeStrategy = function (lastEventId) {\n                        logger.verbose(\"ResumingSubscription: trying to re-establish the subscription\");\n                        if (lastEventId) {\n                            logger.verbose(\"ResumingSubscription: lastEventId: \" + lastEventId);\n                            headers['Last-Event-Id'] = lastEventId;\n                        }\n                        _this.underlyingSubscription = nextSubscribeStrategy({\n                            onEnd: function (error) {\n                                onTransition(new EndedSubscriptionState(error));\n                            },\n                            onError: function (error) {\n                                executeSubscriptionOnce(error, lastEventId);\n                            },\n                            onEvent: function (event) {\n                                lastEventId = event.eventId;\n                                listeners.onEvent(event);\n                            },\n                            onOpen: function (headers) {\n                                onTransition(new OpenSubscriptionState(headers, _this.underlyingSubscription, onTransition));\n                            },\n                            onRetrying: listeners.onRetrying,\n                        }, headers);\n                    };\n                    executeSubscriptionOnce(error, lastEventId);\n                }\n                ResumingSubscriptionState.prototype.unsubscribe = function () {\n                    this.onTransition(new EndingSubscriptionState());\n                    window.clearTimeout(this.timeout);\n                    this.underlyingSubscription.unsubscribe();\n                };\n                return ResumingSubscriptionState;\n            }());\n            var EndingSubscriptionState = (function () {\n                function EndingSubscriptionState(error) {\n                    logger.verbose(\"ResumingSubscription: transitioning to EndingSubscriptionState\");\n                }\n                EndingSubscriptionState.prototype.unsubscribe = function () {\n                    throw new Error('Subscription is already ending');\n                };\n                return EndingSubscriptionState;\n            }());\n            var EndedSubscriptionState = (function () {\n                function EndedSubscriptionState(error) {\n                    logger.verbose(\"ResumingSubscription: transitioning to EndedSubscriptionState\");\n                    listeners.onEnd(error);\n                }\n                EndedSubscriptionState.prototype.unsubscribe = function () {\n                    throw new Error('Subscription has already ended');\n                };\n                return EndedSubscriptionState;\n            }());\n            var FailedSubscriptionState = (function () {\n                function FailedSubscriptionState(error) {\n                    logger.verbose(\"ResumingSubscription: transitioning to FailedSubscriptionState\", error);\n                    listeners.onError(error);\n                }\n                FailedSubscriptionState.prototype.unsubscribe = function () {\n                    throw new Error('Subscription has already ended');\n                };\n                return FailedSubscriptionState;\n            }());\n            this.state = new OpeningSubscriptionState(this.onTransition);\n        }\n        return ResumingSubscription;\n    }());\n    return function (listeners, headers) { return new ResumingSubscription(listeners, headers); };\n};\n\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar network_1 = __webpack_require__(0);\nvar retry_strategy_1 = __webpack_require__(2);\nexports.createRetryingStrategy = function (retryOptions, nextSubscribeStrategy, logger) {\n    var enrichedRetryOptions = retry_strategy_1.createRetryStrategyOptionsOrDefault(retryOptions);\n    var retryResolution = new retry_strategy_1.RetryResolution(enrichedRetryOptions, logger);\n    var RetryingSubscription = (function () {\n        function RetryingSubscription(listeners, headers) {\n            var _this = this;\n            this.unsubscribe = function () {\n                _this.state.unsubscribe();\n            };\n            this.onTransition = function (newState) {\n                _this.state = newState;\n            };\n            var OpeningSubscriptionState = (function () {\n                function OpeningSubscriptionState(onTransition) {\n                    var _this = this;\n                    logger.verbose(\"RetryingSubscription: transitioning to OpeningSubscriptionState\");\n                    this.underlyingSubscription = nextSubscribeStrategy({\n                        onEnd: function (error) { return onTransition(new EndedSubscriptionState(error)); },\n                        onError: function (error) {\n                            return onTransition(new RetryingSubscriptionState(error, onTransition));\n                        },\n                        onEvent: listeners.onEvent,\n                        onOpen: function (headers) {\n                            return onTransition(new OpenSubscriptionState(headers, _this.underlyingSubscription, onTransition));\n                        },\n                        onRetrying: listeners.onRetrying,\n                    }, headers);\n                }\n                OpeningSubscriptionState.prototype.unsubscribe = function () {\n                    this.underlyingSubscription.unsubscribe();\n                    throw new Error('Method not implemented.');\n                };\n                return OpeningSubscriptionState;\n            }());\n            var RetryingSubscriptionState = (function () {\n                function RetryingSubscriptionState(error, onTransition) {\n                    var _this = this;\n                    this.onTransition = onTransition;\n                    logger.verbose(\"RetryingSubscription: transitioning to RetryingSubscriptionState\");\n                    var executeSubscriptionOnce = function (error) {\n                        listeners.onRetrying();\n                        var resolveError = function (error) {\n                            if (error instanceof network_1.ErrorResponse) {\n                                error.headers['Request-Method'] = 'SUBSCRIBE';\n                            }\n                            return retryResolution.attemptRetry(error);\n                        };\n                        var errorResolution = resolveError(error);\n                        if (errorResolution instanceof retry_strategy_1.Retry) {\n                            _this.timeout = window.setTimeout(function () {\n                                executeNextSubscribeStrategy();\n                            }, errorResolution.waitTimeMillis);\n                        }\n                        else {\n                            onTransition(new FailedSubscriptionState(error));\n                        }\n                    };\n                    var executeNextSubscribeStrategy = function () {\n                        logger.verbose(\"RetryingSubscription: trying to re-establish the subscription\");\n                        var underlyingSubscription = nextSubscribeStrategy({\n                            onEnd: function (error) { return onTransition(new EndedSubscriptionState(error)); },\n                            onError: function (error) { return executeSubscriptionOnce(error); },\n                            onEvent: listeners.onEvent,\n                            onOpen: function (headers) {\n                                onTransition(new OpenSubscriptionState(headers, underlyingSubscription, onTransition));\n                            },\n                            onRetrying: listeners.onRetrying,\n                        }, headers);\n                    };\n                    executeSubscriptionOnce(error);\n                }\n                RetryingSubscriptionState.prototype.unsubscribe = function () {\n                    window.clearTimeout(this.timeout);\n                    this.onTransition(new EndedSubscriptionState());\n                };\n                return RetryingSubscriptionState;\n            }());\n            var OpenSubscriptionState = (function () {\n                function OpenSubscriptionState(headers, underlyingSubscription, onTransition) {\n                    this.underlyingSubscription = underlyingSubscription;\n                    this.onTransition = onTransition;\n                    logger.verbose(\"RetryingSubscription: transitioning to OpenSubscriptionState\");\n                    listeners.onOpen(headers);\n                }\n                OpenSubscriptionState.prototype.unsubscribe = function () {\n                    this.underlyingSubscription.unsubscribe();\n                    this.onTransition(new EndedSubscriptionState());\n                };\n                return OpenSubscriptionState;\n            }());\n            var EndedSubscriptionState = (function () {\n                function EndedSubscriptionState(error) {\n                    logger.verbose(\"RetryingSubscription: transitioning to EndedSubscriptionState\");\n                    listeners.onEnd(error);\n                }\n                EndedSubscriptionState.prototype.unsubscribe = function () {\n                    throw new Error('Subscription has already ended');\n                };\n                return EndedSubscriptionState;\n            }());\n            var FailedSubscriptionState = (function () {\n                function FailedSubscriptionState(error) {\n                    logger.verbose(\"RetryingSubscription: transitioning to FailedSubscriptionState\", error);\n                    listeners.onError(error);\n                }\n                FailedSubscriptionState.prototype.unsubscribe = function () {\n                    throw new Error('Subscription has already ended');\n                };\n                return FailedSubscriptionState;\n            }());\n            this.state = new OpeningSubscriptionState(this.onTransition);\n        }\n        return RetryingSubscription;\n    }());\n    return function (listeners, headers) { return new RetryingSubscription(listeners, headers); };\n};\n\n\n/***/ }),\n/* 7 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar network_1 = __webpack_require__(0);\nexports.createTokenProvidingStrategy = function (nextSubscribeStrategy, logger, tokenProvider) {\n    if (tokenProvider) {\n        return function (listeners, headers) {\n            return new TokenProvidingSubscription(logger, listeners, headers, tokenProvider, nextSubscribeStrategy);\n        };\n    }\n    return nextSubscribeStrategy;\n};\nvar TokenProvidingSubscription = (function () {\n    function TokenProvidingSubscription(logger, listeners, headers, tokenProvider, nextSubscribeStrategy) {\n        var _this = this;\n        this.logger = logger;\n        this.listeners = listeners;\n        this.headers = headers;\n        this.tokenProvider = tokenProvider;\n        this.nextSubscribeStrategy = nextSubscribeStrategy;\n        this.unsubscribe = function () {\n            _this.state.unsubscribe();\n            _this.state = new InactiveState(_this.logger);\n        };\n        this.state = new ActiveState(logger, headers, nextSubscribeStrategy);\n        this.subscribe();\n    }\n    TokenProvidingSubscription.prototype.subscribe = function () {\n        var _this = this;\n        this.tokenProvider\n            .fetchToken()\n            .then(function (token) {\n            var existingListeners = Object.assign({}, _this.listeners);\n            _this.state.subscribe(token, {\n                onEnd: function (error) {\n                    _this.state = new InactiveState(_this.logger);\n                    existingListeners.onEnd(error);\n                },\n                onError: function (error) {\n                    if (_this.isTokenExpiredError(error)) {\n                        _this.tokenProvider.clearToken(token);\n                        _this.subscribe();\n                    }\n                    else {\n                        _this.state = new InactiveState(_this.logger);\n                        existingListeners.onError(error);\n                    }\n                },\n                onEvent: _this.listeners.onEvent,\n                onOpen: _this.listeners.onOpen,\n            });\n        })\n            .catch(function (error) {\n            _this.logger.debug(\"TokenProvidingSubscription: error when fetching token: \" + error);\n            _this.state = new InactiveState(_this.logger);\n        });\n    };\n    TokenProvidingSubscription.prototype.isTokenExpiredError = function (error) {\n        return (error instanceof network_1.ErrorResponse &&\n            error.statusCode === 401 &&\n            error.info === 'authentication/expired');\n    };\n    return TokenProvidingSubscription;\n}());\nvar ActiveState = (function () {\n    function ActiveState(logger, headers, nextSubscribeStrategy) {\n        this.logger = logger;\n        this.headers = headers;\n        this.nextSubscribeStrategy = nextSubscribeStrategy;\n        logger.verbose(\"TokenProvidingSubscription: transitioning to TokenProvidingState\");\n    }\n    ActiveState.prototype.subscribe = function (token, listeners) {\n        var _this = this;\n        this.putTokenIntoHeader(token);\n        this.underlyingSubscription = this.nextSubscribeStrategy({\n            onEnd: function (error) {\n                _this.logger.verbose(\"TokenProvidingSubscription: subscription ended\");\n                listeners.onEnd(error);\n            },\n            onError: function (error) {\n                _this.logger.verbose(\"TokenProvidingSubscription: subscription errored: \" + error);\n                listeners.onError(error);\n            },\n            onEvent: listeners.onEvent,\n            onOpen: function (headers) {\n                _this.logger.verbose(\"TokenProvidingSubscription: subscription opened\");\n                listeners.onOpen(headers);\n            },\n            onRetrying: listeners.onRetrying,\n        }, this.headers);\n    };\n    ActiveState.prototype.unsubscribe = function () {\n        this.underlyingSubscription.unsubscribe();\n    };\n    ActiveState.prototype.putTokenIntoHeader = function (token) {\n        this.headers['Authorization'] = \"Bearer \" + token;\n        this.logger.verbose(\"TokenProvidingSubscription: token fetched: \" + token);\n    };\n    return ActiveState;\n}());\nvar InactiveState = (function () {\n    function InactiveState(logger) {\n        this.logger = logger;\n        logger.verbose(\"TokenProvidingSubscription: transitioning to OpenTokenProvidingSubscriptionState\");\n    }\n    InactiveState.prototype.subscribe = function (token, listeners) {\n        this.logger.verbose('TokenProvidingSubscription: subscribe called in Inactive state; doing nothing');\n    };\n    InactiveState.prototype.unsubscribe = function () {\n        this.logger.verbose('TokenProvidingSubscription: unsubscribe called in Inactive state; doing nothing');\n    };\n    return InactiveState;\n}());\n\n\n/***/ }),\n/* 8 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createTransportStrategy = function (path, transport, logger) {\n    return function (listeners, headers) { return transport.subscribe(path, listeners, headers); };\n};\n\n\n/***/ }),\n/* 9 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar base_client_1 = __webpack_require__(3);\nexports.BaseClient = base_client_1.BaseClient;\nvar instance_1 = __webpack_require__(14);\nexports.Instance = instance_1.default;\nvar logger_1 = __webpack_require__(1);\nexports.ConsoleLogger = logger_1.ConsoleLogger;\nexports.EmptyLogger = logger_1.EmptyLogger;\nvar network_1 = __webpack_require__(0);\nexports.ErrorResponse = network_1.ErrorResponse;\nexports.NetworkError = network_1.NetworkError;\nexports.responseToHeadersObject = network_1.responseToHeadersObject;\nexports.XhrReadyState = network_1.XhrReadyState;\nvar request_1 = __webpack_require__(4);\nexports.executeNetworkRequest = request_1.executeNetworkRequest;\nvar resuming_subscription_1 = __webpack_require__(5);\nexports.createResumingStrategy = resuming_subscription_1.createResumingStrategy;\nvar retry_strategy_1 = __webpack_require__(2);\nexports.createRetryStrategyOptionsOrDefault = retry_strategy_1.createRetryStrategyOptionsOrDefault;\nexports.DoNotRetry = retry_strategy_1.DoNotRetry;\nexports.Retry = retry_strategy_1.Retry;\nexports.RetryResolution = retry_strategy_1.RetryResolution;\nvar retrying_subscription_1 = __webpack_require__(6);\nexports.createRetryingStrategy = retrying_subscription_1.createRetryingStrategy;\nvar token_providing_subscription_1 = __webpack_require__(7);\nexports.createTokenProvidingStrategy = token_providing_subscription_1.createTokenProvidingStrategy;\nvar transports_1 = __webpack_require__(8);\nexports.createTransportStrategy = transports_1.createTransportStrategy;\nexports.default = {\n    BaseClient: base_client_1.BaseClient,\n    ConsoleLogger: logger_1.ConsoleLogger,\n    EmptyLogger: logger_1.EmptyLogger,\n    Instance: instance_1.default,\n};\n\n\n/***/ }),\n/* 10 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.subscribeStrategyListenersFromSubscriptionListeners = function (subListeners) {\n    return {\n        onEnd: subListeners.onEnd,\n        onError: subListeners.onError,\n        onEvent: subListeners.onEvent,\n        onOpen: subListeners.onOpen,\n        onRetrying: subListeners.onRetrying,\n    };\n};\n\n\n/***/ }),\n/* 11 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.replaceMissingListenersWithNoOps = function (listeners) {\n    var onEndNoOp = function (error) { };\n    var onEnd = listeners.onEnd || onEndNoOp;\n    var onErrorNoOp = function (error) { };\n    var onError = listeners.onError || onErrorNoOp;\n    var onEventNoOp = function (event) { };\n    var onEvent = listeners.onEvent || onEventNoOp;\n    var onOpenNoOp = function (headers) { };\n    var onOpen = listeners.onOpen || onOpenNoOp;\n    var onRetryingNoOp = function () { };\n    var onRetrying = listeners.onRetrying || onRetryingNoOp;\n    var onSubscribeNoOp = function () { };\n    var onSubscribe = listeners.onSubscribe || onSubscribeNoOp;\n    return {\n        onEnd: onEnd,\n        onError: onError,\n        onEvent: onEvent,\n        onOpen: onOpen,\n        onRetrying: onRetrying,\n        onSubscribe: onSubscribe,\n    };\n};\n\n\n/***/ }),\n/* 12 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar network_1 = __webpack_require__(0);\nvar HttpTransportState;\n(function (HttpTransportState) {\n    HttpTransportState[HttpTransportState[\"UNOPENED\"] = 0] = \"UNOPENED\";\n    HttpTransportState[HttpTransportState[\"OPENING\"] = 1] = \"OPENING\";\n    HttpTransportState[HttpTransportState[\"OPEN\"] = 2] = \"OPEN\";\n    HttpTransportState[HttpTransportState[\"ENDING\"] = 3] = \"ENDING\";\n    HttpTransportState[HttpTransportState[\"ENDED\"] = 4] = \"ENDED\";\n})(HttpTransportState = exports.HttpTransportState || (exports.HttpTransportState = {}));\nvar HttpSubscription = (function () {\n    function HttpSubscription(xhr, listeners) {\n        var _this = this;\n        this.gotEOS = false;\n        this.lastNewlineIndex = 0;\n        this.state = HttpTransportState.UNOPENED;\n        this.xhr = xhr;\n        this.listeners = listeners;\n        this.xhr.onreadystatechange = function () {\n            switch (_this.xhr.readyState) {\n                case network_1.XhrReadyState.UNSENT:\n                case network_1.XhrReadyState.OPENED:\n                case network_1.XhrReadyState.HEADERS_RECEIVED:\n                    _this.assertStateIsIn(HttpTransportState.OPENING);\n                    break;\n                case network_1.XhrReadyState.LOADING:\n                    _this.onLoading();\n                    break;\n                case network_1.XhrReadyState.DONE:\n                    _this.onDone();\n                    break;\n            }\n        };\n        this.state = HttpTransportState.OPENING;\n        this.xhr.send();\n        return this;\n    }\n    HttpSubscription.prototype.unsubscribe = function () {\n        this.state = HttpTransportState.ENDED;\n        this.xhr.abort();\n        if (this.listeners.onEnd) {\n            this.listeners.onEnd(null);\n        }\n    };\n    HttpSubscription.prototype.onLoading = function () {\n        this.assertStateIsIn(HttpTransportState.OPENING, HttpTransportState.OPEN, HttpTransportState.ENDING);\n        if (this.xhr.status === 200) {\n            if (this.state === HttpTransportState.OPENING) {\n                this.state = HttpTransportState.OPEN;\n                window.console.log(network_1.responseToHeadersObject(this.xhr.getAllResponseHeaders()));\n                if (this.listeners.onOpen) {\n                    this.listeners.onOpen(network_1.responseToHeadersObject(this.xhr.getAllResponseHeaders()));\n                }\n            }\n            this.assertStateIsIn(HttpTransportState.OPEN);\n            var err = this.onChunk();\n            this.assertStateIsIn(HttpTransportState.OPEN, HttpTransportState.ENDING);\n            if (err) {\n                this.state = HttpTransportState.ENDED;\n                if (err instanceof network_1.ErrorResponse && err.statusCode !== 204) {\n                    if (this.listeners.onError) {\n                        this.listeners.onError(err);\n                    }\n                }\n            }\n            else {\n            }\n        }\n    };\n    HttpSubscription.prototype.onDone = function () {\n        if (this.xhr.status === 200) {\n            if (this.state === HttpTransportState.OPENING) {\n                this.state = HttpTransportState.OPEN;\n                if (this.listeners.onOpen) {\n                    this.listeners.onOpen(network_1.responseToHeadersObject(this.xhr.getAllResponseHeaders()));\n                }\n            }\n            this.assertStateIsIn(HttpTransportState.OPEN, HttpTransportState.ENDING);\n            var err = this.onChunk();\n            if (err) {\n                this.state = HttpTransportState.ENDED;\n                if (err.statusCode === 204) {\n                    if (this.listeners.onEnd) {\n                        this.listeners.onEnd(null);\n                    }\n                }\n                else {\n                    if (this.listeners.onError) {\n                        this.listeners.onError(err);\n                    }\n                }\n            }\n            else if (this.state <= HttpTransportState.ENDING) {\n                if (this.listeners.onError) {\n                    this.listeners.onError(new Error('HTTP response ended without receiving EOS message'));\n                }\n            }\n            else {\n                if (this.listeners.onEnd) {\n                    this.listeners.onEnd(null);\n                }\n            }\n        }\n        else {\n            this.assertStateIsIn(HttpTransportState.OPENING, HttpTransportState.OPEN, HttpTransportState.ENDED);\n            if (this.state === HttpTransportState.ENDED) {\n                return;\n            }\n            else if (this.xhr.status === 0) {\n                if (this.listeners.onError) {\n                    this.listeners.onError(new network_1.NetworkError('Connection lost.'));\n                }\n            }\n            else {\n                if (this.listeners.onError) {\n                    this.listeners.onError(network_1.ErrorResponse.fromXHR(this.xhr));\n                }\n            }\n        }\n    };\n    HttpSubscription.prototype.onChunk = function () {\n        this.assertStateIsIn(HttpTransportState.OPEN);\n        var response = this.xhr.responseText;\n        var newlineIndex = response.lastIndexOf('\\n');\n        if (newlineIndex > this.lastNewlineIndex) {\n            var rawEvents = response\n                .slice(this.lastNewlineIndex, newlineIndex)\n                .split('\\n');\n            this.lastNewlineIndex = newlineIndex;\n            for (var _i = 0, rawEvents_1 = rawEvents; _i < rawEvents_1.length; _i++) {\n                var rawEvent = rawEvents_1[_i];\n                if (rawEvent.length === 0) {\n                    continue;\n                }\n                var data = JSON.parse(rawEvent);\n                var err = this.onMessage(data);\n                if (err != null) {\n                    return err;\n                }\n            }\n        }\n    };\n    HttpSubscription.prototype.assertStateIsIn = function () {\n        var _this = this;\n        var validStates = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            validStates[_i] = arguments[_i];\n        }\n        var stateIsValid = validStates.some(function (validState) { return validState === _this.state; });\n        if (!stateIsValid) {\n            var expectedStates = validStates\n                .map(function (state) { return HttpTransportState[state]; })\n                .join(', ');\n            var actualState = HttpTransportState[this.state];\n            window.console.warn(\"Expected this.state to be one of [\" + expectedStates + \"] but it is \" + actualState);\n        }\n    };\n    HttpSubscription.prototype.onMessage = function (message) {\n        this.assertStateIsIn(HttpTransportState.OPEN);\n        this.verifyMessage(message);\n        switch (message[0]) {\n            case 0:\n                return null;\n            case 1:\n                return this.onEventMessage(message);\n            case 255:\n                return this.onEOSMessage(message);\n            default:\n                return new Error('Unknown Message: ' + JSON.stringify(message));\n        }\n    };\n    HttpSubscription.prototype.onEventMessage = function (eventMessage) {\n        this.assertStateIsIn(HttpTransportState.OPEN);\n        if (eventMessage.length !== 4) {\n            return new Error('Event message has ' + eventMessage.length + ' elements (expected 4)');\n        }\n        var _ = eventMessage[0], id = eventMessage[1], headers = eventMessage[2], body = eventMessage[3];\n        if (typeof id !== 'string') {\n            return new Error('Invalid event ID in message: ' + JSON.stringify(eventMessage));\n        }\n        if (typeof headers !== 'object' || Array.isArray(headers)) {\n            return new Error('Invalid event headers in message: ' + JSON.stringify(eventMessage));\n        }\n        if (this.listeners.onEvent) {\n            this.listeners.onEvent({ body: body, headers: headers, eventId: id });\n        }\n        return null;\n    };\n    HttpSubscription.prototype.onEOSMessage = function (eosMessage) {\n        this.assertStateIsIn(HttpTransportState.OPEN);\n        if (eosMessage.length !== 4) {\n            return new Error('EOS message has ' + eosMessage.length + ' elements (expected 4)');\n        }\n        var _ = eosMessage[0], statusCode = eosMessage[1], headers = eosMessage[2], info = eosMessage[3];\n        if (typeof statusCode !== 'number') {\n            return new Error('Invalid EOS Status Code');\n        }\n        if (typeof headers !== 'object' || Array.isArray(headers)) {\n            return new Error('Invalid EOS ElementsHeaders');\n        }\n        this.state = HttpTransportState.ENDING;\n        return new network_1.ErrorResponse(statusCode, headers, info);\n    };\n    HttpSubscription.prototype.verifyMessage = function (message) {\n        if (this.gotEOS) {\n            return new Error('Got another message after EOS message');\n        }\n        if (!Array.isArray(message)) {\n            return new Error('Message is not an array');\n        }\n        if (message.length < 1) {\n            return new Error('Message is empty array');\n        }\n    };\n    return HttpSubscription;\n}());\nvar HttpTransport = (function () {\n    function HttpTransport(host, encrypted) {\n        this.baseURL = (encrypted !== false ? 'https' : 'http') + \"://\" + host;\n    }\n    HttpTransport.prototype.request = function (requestOptions) {\n        return this.createXHR(this.baseURL, requestOptions);\n    };\n    HttpTransport.prototype.subscribe = function (path, listeners, headers) {\n        var requestOptions = {\n            headers: headers,\n            method: 'SUBSCRIBE',\n            path: path,\n        };\n        return new HttpSubscription(this.createXHR(this.baseURL, requestOptions), listeners);\n    };\n    HttpTransport.prototype.createXHR = function (baseURL, options) {\n        var xhr = new window.XMLHttpRequest();\n        var path = options.path.replace(/^\\/+/, '');\n        var endpoint = baseURL + \"/\" + path;\n        xhr.open(options.method.toUpperCase(), endpoint, true);\n        if (options.body) {\n            xhr.setRequestHeader('content-type', 'application/json');\n        }\n        if (options.jwt) {\n            xhr.setRequestHeader('authorization', \"Bearer \" + options.jwt);\n        }\n        if (options.headers) {\n            for (var key in options.headers) {\n                if (options.headers.hasOwnProperty(key)) {\n                    xhr.setRequestHeader(key, options.headers[key]);\n                }\n            }\n        }\n        return xhr;\n    };\n    return HttpTransport;\n}());\nexports.default = HttpTransport;\n\n\n/***/ }),\n/* 13 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar network_1 = __webpack_require__(0);\nvar SubscribeMessageType = 100;\nvar OpenMessageType = 101;\nvar EventMessageType = 102;\nvar UnsubscribeMessageType = 198;\nvar EosMessageType = 199;\nvar PingMessageType = 16;\nvar PongMessageType = 17;\nvar CloseMessageType = 99;\nvar WSReadyState;\n(function (WSReadyState) {\n    WSReadyState[WSReadyState[\"Connecting\"] = 0] = \"Connecting\";\n    WSReadyState[WSReadyState[\"Open\"] = 1] = \"Open\";\n    WSReadyState[WSReadyState[\"Closing\"] = 2] = \"Closing\";\n    WSReadyState[WSReadyState[\"Closed\"] = 3] = \"Closed\";\n})(WSReadyState = exports.WSReadyState || (exports.WSReadyState = {}));\nvar WsSubscriptions = (function () {\n    function WsSubscriptions() {\n        this.subscriptions = {};\n    }\n    WsSubscriptions.prototype.add = function (subID, path, listeners, headers) {\n        this.subscriptions[subID] = {\n            headers: headers,\n            listeners: listeners,\n            path: path,\n        };\n        return subID;\n    };\n    WsSubscriptions.prototype.has = function (subID) {\n        return this.subscriptions[subID] !== undefined;\n    };\n    WsSubscriptions.prototype.isEmpty = function () {\n        return Object.keys(this.subscriptions).length === 0;\n    };\n    WsSubscriptions.prototype.remove = function (subID) {\n        return delete this.subscriptions[subID];\n    };\n    WsSubscriptions.prototype.get = function (subID) {\n        return this.subscriptions[subID];\n    };\n    WsSubscriptions.prototype.getAll = function () {\n        return this.subscriptions;\n    };\n    WsSubscriptions.prototype.getAllAsArray = function () {\n        var _this = this;\n        return Object.keys(this.subscriptions).map(function (subID) { return (__assign({ subID: parseInt(subID, 10) }, _this.subscriptions[parseInt(subID, 10)])); });\n    };\n    WsSubscriptions.prototype.removeAll = function () {\n        this.subscriptions = {};\n    };\n    return WsSubscriptions;\n}());\nvar WsSubscription = (function () {\n    function WsSubscription(wsTransport, subID) {\n        this.wsTransport = wsTransport;\n        this.subID = subID;\n    }\n    WsSubscription.prototype.unsubscribe = function () {\n        this.wsTransport.unsubscribe(this.subID);\n    };\n    return WsSubscription;\n}());\nvar pingIntervalMs = 30000;\nvar pingTimeoutMs = 10000;\nvar WebSocketTransport = (function () {\n    function WebSocketTransport(host) {\n        this.webSocketPath = '/ws';\n        this.forcedClose = false;\n        this.closedError = null;\n        this.baseURL = \"wss://\" + host + this.webSocketPath;\n        this.lastSubscriptionID = 0;\n        this.subscriptions = new WsSubscriptions();\n        this.pendingSubscriptions = new WsSubscriptions();\n        this.connect();\n    }\n    WebSocketTransport.prototype.subscribe = function (path, listeners, headers) {\n        this.tryReconnectIfNeeded();\n        var subID = this.lastSubscriptionID++;\n        if (this.socket.readyState !== WSReadyState.Open) {\n            this.pendingSubscriptions.add(subID, path, listeners, headers);\n            return new WsSubscription(this, subID);\n        }\n        this.subscriptions.add(subID, path, listeners, headers);\n        this.sendMessage(this.getMessage(SubscribeMessageType, subID, path, headers));\n        return new WsSubscription(this, subID);\n    };\n    WebSocketTransport.prototype.unsubscribe = function (subID) {\n        this.sendMessage(this.getMessage(UnsubscribeMessageType, subID));\n        var subscription = this.subscriptions.get(subID);\n        if (subscription.listeners.onEnd) {\n            subscription.listeners.onEnd(null);\n        }\n        this.subscriptions.remove(subID);\n    };\n    WebSocketTransport.prototype.connect = function () {\n        var _this = this;\n        this.close();\n        this.forcedClose = false;\n        this.closedError = null;\n        this.socket = new window.WebSocket(this.baseURL);\n        this.socket.onopen = function (event) {\n            var allPendingSubscriptions = _this.pendingSubscriptions.getAllAsArray();\n            allPendingSubscriptions.forEach(function (subscription) {\n                var subID = subscription.subID, path = subscription.path, listeners = subscription.listeners, headers = subscription.headers;\n                _this.subscribePending(path, listeners, headers, subID);\n            });\n            _this.pendingSubscriptions.removeAll();\n            _this.pingInterval = window.setInterval(function () {\n                if (_this.pongTimeout) {\n                    return;\n                }\n                var now = new Date().getTime();\n                if (pingTimeoutMs > now - _this.lastMessageReceivedTimestamp) {\n                    return;\n                }\n                _this.sendMessage(_this.getMessage(PingMessageType, now));\n                _this.lastSentPingID = now;\n                _this.pongTimeout = window.setTimeout(function () {\n                    var now = new Date().getTime();\n                    if (pingTimeoutMs > now - _this.lastMessageReceivedTimestamp) {\n                        _this.pongTimeout = null;\n                        return;\n                    }\n                    _this.close(new network_1.NetworkError(\"Pong response wasn't received until timeout.\"));\n                }, pingTimeoutMs);\n            }, pingIntervalMs);\n        };\n        this.socket.onmessage = function (event) { return _this.receiveMessage(event); };\n        this.socket.onerror = function (event) {\n            _this.close(new network_1.NetworkError('Connection was lost.'));\n        };\n        this.socket.onclose = function (event) {\n            if (!_this.forcedClose) {\n                _this.tryReconnectIfNeeded();\n                return;\n            }\n            var callback = _this.closedError\n                ? function (subscription) {\n                    if (subscription.listeners.onError) {\n                        subscription.listeners.onError(_this.closedError);\n                    }\n                }\n                : function (subscription) {\n                    if (subscription.listeners.onEnd) {\n                        subscription.listeners.onEnd(null);\n                    }\n                };\n            var allSubscriptions = _this.pendingSubscriptions.isEmpty() === false\n                ? _this.pendingSubscriptions\n                : _this.subscriptions;\n            allSubscriptions.getAllAsArray().forEach(callback);\n            allSubscriptions.removeAll();\n            if (_this.closedError) {\n                _this.tryReconnectIfNeeded();\n            }\n        };\n    };\n    WebSocketTransport.prototype.close = function (error) {\n        if (!(this.socket instanceof window.WebSocket)) {\n            return;\n        }\n        this.forcedClose = true;\n        this.closedError = error;\n        this.socket.close();\n        window.clearTimeout(this.pingInterval);\n        window.clearTimeout(this.pongTimeout);\n        delete this.pongTimeout;\n        this.lastSentPingID = null;\n    };\n    WebSocketTransport.prototype.tryReconnectIfNeeded = function () {\n        if (this.socket.readyState !== WSReadyState.Closed) {\n            return;\n        }\n        this.connect();\n    };\n    WebSocketTransport.prototype.subscribePending = function (path, listeners, headers, subID) {\n        if (subID === undefined) {\n            window.console.logger.debug(\"Subscription to path \" + path + \" has an undefined ID\");\n            return;\n        }\n        this.subscriptions.add(subID, path, listeners, headers);\n        this.sendMessage(this.getMessage(SubscribeMessageType, subID, path, headers));\n    };\n    WebSocketTransport.prototype.getMessage = function (messageType, id, path, headers) {\n        return [messageType, id, path, headers];\n    };\n    WebSocketTransport.prototype.sendMessage = function (message) {\n        if (this.socket.readyState !== WSReadyState.Open) {\n            return window.console.warn(\"Can't send in \\\"\" + WSReadyState[this.socket.readyState] + \"\\\" state\");\n        }\n        this.socket.send(JSON.stringify(message));\n    };\n    WebSocketTransport.prototype.subscription = function (subID) {\n        return this.subscriptions.get(subID);\n    };\n    WebSocketTransport.prototype.receiveMessage = function (event) {\n        this.lastMessageReceivedTimestamp = new Date().getTime();\n        var message;\n        try {\n            message = JSON.parse(event.data);\n        }\n        catch (err) {\n            this.close(new Error(\"Message is not valid JSON format. Getting \" + event.data));\n            return;\n        }\n        var nonValidMessageError = this.validateMessage(message);\n        if (nonValidMessageError) {\n            this.close(new Error(nonValidMessageError.message));\n            return;\n        }\n        var messageType = message.shift();\n        switch (messageType) {\n            case PongMessageType:\n                this.onPongMessage(message);\n                return;\n            case PingMessageType:\n                this.onPingMessage(message);\n                return;\n            case CloseMessageType:\n                this.onCloseMessage(message);\n                return;\n        }\n        var subID = message.shift();\n        var subscription = this.subscription(subID);\n        if (!subscription) {\n            this.close(new Error(\"Received message for non existing subscription id: \\\"\" + subID + \"\\\"\"));\n            return;\n        }\n        var listeners = subscription.listeners;\n        switch (messageType) {\n            case OpenMessageType:\n                this.onOpenMessage(message, subID, listeners);\n                break;\n            case EventMessageType:\n                this.onEventMessage(message, listeners);\n                break;\n            case EosMessageType:\n                this.onEOSMessage(message, subID, listeners);\n                break;\n            default:\n                this.close(new Error('Received non existing type of message.'));\n        }\n    };\n    WebSocketTransport.prototype.validateMessage = function (message) {\n        if (!Array.isArray(message)) {\n            return new Error(\"Message is expected to be an array. Getting: \" + JSON.stringify(message));\n        }\n        if (message.length < 1) {\n            return new Error(\"Message is empty array: \" + JSON.stringify(message));\n        }\n        return null;\n    };\n    WebSocketTransport.prototype.onOpenMessage = function (message, subID, subscriptionListeners) {\n        if (subscriptionListeners.onOpen) {\n            subscriptionListeners.onOpen(message[1]);\n        }\n    };\n    WebSocketTransport.prototype.onEventMessage = function (eventMessage, subscriptionListeners) {\n        if (eventMessage.length !== 3) {\n            return new Error('Event message has ' + eventMessage.length + ' elements (expected 4)');\n        }\n        var eventId = eventMessage[0], headers = eventMessage[1], body = eventMessage[2];\n        if (typeof eventId !== 'string') {\n            return new Error(\"Invalid event ID in message: \" + JSON.stringify(eventMessage));\n        }\n        if (typeof headers !== 'object' || Array.isArray(headers)) {\n            return new Error(\"Invalid event headers in message: \" + JSON.stringify(eventMessage));\n        }\n        if (subscriptionListeners.onEvent) {\n            subscriptionListeners.onEvent({ eventId: eventId, headers: headers, body: body });\n        }\n    };\n    WebSocketTransport.prototype.onEOSMessage = function (eosMessage, subID, subscriptionListeners) {\n        this.subscriptions.remove(subID);\n        if (eosMessage.length !== 3) {\n            if (subscriptionListeners.onError) {\n                subscriptionListeners.onError(new Error(\"EOS message has \" + eosMessage.length + \" elements (expected 4)\"));\n            }\n            return;\n        }\n        var statusCode = eosMessage[0], headers = eosMessage[1], body = eosMessage[2];\n        if (typeof statusCode !== 'number') {\n            if (subscriptionListeners.onError) {\n                subscriptionListeners.onError(new Error('Invalid EOS Status Code'));\n            }\n            return;\n        }\n        if (typeof headers !== 'object' || Array.isArray(headers)) {\n            if (subscriptionListeners.onError) {\n                subscriptionListeners.onError(new Error('Invalid EOS ElementsHeaders'));\n            }\n            return;\n        }\n        if (statusCode === 204) {\n            if (subscriptionListeners.onEnd) {\n                subscriptionListeners.onEnd(null);\n            }\n            return;\n        }\n        if (subscriptionListeners.onError) {\n            subscriptionListeners.onError(new network_1.ErrorResponse(statusCode, headers, body));\n        }\n        return;\n    };\n    WebSocketTransport.prototype.onCloseMessage = function (closeMessage) {\n        var statusCode = closeMessage[0], headers = closeMessage[1], body = closeMessage[2];\n        if (typeof statusCode !== 'number') {\n            return this.close(new Error('Close message: Invalid EOS Status Code'));\n        }\n        if (typeof headers !== 'object' || Array.isArray(headers)) {\n            return this.close(new Error('Close message: Invalid EOS ElementsHeaders'));\n        }\n        this.close();\n    };\n    WebSocketTransport.prototype.onPongMessage = function (message) {\n        var receviedPongID = message[0];\n        if (this.lastSentPingID !== receviedPongID) {\n            this.close(new network_1.NetworkError(\"Didn't received pong with proper ID\"));\n        }\n        window.clearTimeout(this.pongTimeout);\n        delete this.pongTimeout;\n        this.lastSentPingID = null;\n    };\n    WebSocketTransport.prototype.onPingMessage = function (message) {\n        var receviedPingID = message[0];\n        this.sendMessage(this.getMessage(PongMessageType, receviedPingID));\n    };\n    return WebSocketTransport;\n}());\nexports.default = WebSocketTransport;\n\n\n/***/ }),\n/* 14 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar base_client_1 = __webpack_require__(3);\nvar logger_1 = __webpack_require__(1);\nvar HOST_BASE = 'pusherplatform.io';\nvar Instance = (function () {\n    function Instance(options) {\n        if (!options.locator) {\n            throw new Error('Expected `locator` property in Instance options!');\n        }\n        if (options.locator.split(':').length !== 3) {\n            throw new Error('The instance locator property is in the wrong format!');\n        }\n        if (!options.serviceName) {\n            throw new Error('Expected `serviceName` property in Instance options!');\n        }\n        if (!options.serviceVersion) {\n            throw new Error('Expected `serviceVersion` property in Instance otpions!');\n        }\n        var splitLocator = options.locator.split(':');\n        this.platformVersion = splitLocator[0];\n        this.cluster = splitLocator[1];\n        this.id = splitLocator[2];\n        this.serviceName = options.serviceName;\n        this.serviceVersion = options.serviceVersion;\n        this.host = options.host || this.cluster + \".\" + HOST_BASE;\n        this.logger = options.logger || new logger_1.ConsoleLogger();\n        this.client =\n            options.client ||\n                new base_client_1.BaseClient({\n                    encrypted: options.encrypted,\n                    host: this.host,\n                    logger: this.logger,\n                });\n        this.tokenProvider = options.tokenProvider;\n    }\n    Instance.prototype.request = function (options, tokenParams) {\n        options.path = this.absPath(options.path);\n        if (options.headers == null || options.headers === undefined) {\n            options.headers = {};\n        }\n        options.tokenProvider = options.tokenProvider || this.tokenProvider;\n        return this.client.request(options, tokenParams);\n    };\n    Instance.prototype.subscribeNonResuming = function (options) {\n        var headers = options.headers || {};\n        var retryStrategyOptions = options.retryStrategyOptions || {};\n        var tokenProvider = options.tokenProvider || this.tokenProvider;\n        return this.client.subscribeNonResuming(this.absPath(options.path), headers, options.listeners, retryStrategyOptions, tokenProvider);\n    };\n    Instance.prototype.subscribeResuming = function (options) {\n        var headers = options.headers || {};\n        var retryStrategyOptions = options.retryStrategyOptions || {};\n        var tokenProvider = options.tokenProvider || this.tokenProvider;\n        return this.client.subscribeResuming(this.absPath(options.path), headers, options.listeners, retryStrategyOptions, options.initialEventId, tokenProvider);\n    };\n    Instance.prototype.absPath = function (relativePath) {\n        return (\"/services/\" + this.serviceName + \"/\" + this.serviceVersion + \"/\" + this.id + \"/\" + relativePath)\n            .replace(/\\/+/g, '/')\n            .replace(/\\/+$/, '');\n    };\n    return Instance;\n}());\nexports.default = Instance;\n\n\n/***/ })\n/******/ ]);\n});","export function parseResponse(promise) {\n  return new Promise((resolve, reject) => {\n    promise.then(response => {\n      try {\n        resolve(JSON.parse(response));\n      } catch (err) {\n        reject(err);\n      }\n    }).catch(reject);\n  });\n}\n\nexport function urlEncode(data) {\n  return Object.keys(data)\n    .filter(key => data[key] !== undefined)\n    .map(key => `${ key }=${ encodeURIComponent(data[key]) }`)\n    .join(\"&\");\n}\n\nexport function queryString(data) {\n  const encodedData = urlEncode(data);\n  return encodedData ? `?${ encodedData }` : \"\";\n}\n\nexport function unixTimeNow() {\n  return Math.floor(Date.now() / 1000);\n}\n","import { parseResponse, queryString } from \"./utils\";\n\nexport default class Feed {\n  constructor({ instance, feedId, readTokenProvider }) {\n    this.instance = instance;\n    this.feedId = feedId;\n    this.readTokenProvider = readTokenProvider;\n  }\n\n  subscribe({ onOpen, onItem, ...options } = {}) {\n    if (onOpen && typeof onOpen !== \"function\") {\n      throw new TypeError(`onOpen must be a function, got ${ onOpen }`);\n    }\n    if (typeof onItem !== \"function\") {\n      throw new TypeError(\"Must provide an `onItem` callback\");\n    }\n    const onEvent = event => {\n      if (event.body.type === 0 && onOpen) {\n        onOpen(event.body.data);\n      } else if (event.body.type === 1 && onItem) {\n        onItem(event.body.data);\n      } else if (event.body.type > 1) {\n        throw new TypeError(`Unsupported event type '${\n          event.body.type\n        }'`);\n      }\n    };\n    return this.instance.subscribeResuming({\n      ...options,\n      // Mapping our itemId to platform library eventId\n      initialEventId: options.lastItemId,\n      path: `feeds/${ this.feedId }/items` + queryString({\n        previous_items: options.previousItems,\n      }),\n      tokenProvider: this.readTokenProvider,\n      listeners: {\n        onEvent,\n        onSubscribe: options.onSubscribe,\n        onRetrying: options.onRetrying,\n        onError: options.onError,\n        onEnd: options.onEnd,\n      }\n    });\n  }\n\n  paginate({ cursor, limit = 50 } = {}) {\n    return parseResponse(this.instance.request({\n      method: \"GET\",\n      path: `feeds/${ this.feedId }/items` + queryString({\n        cursor,\n        limit,\n      }),\n      tokenProvider: this.readTokenProvider,\n    }));\n  }\n}\n","export const cacheExpiryTolerance = 10 * 60; // 10 minutes (in seconds)\nexport const feedIdRegex = /^[a-zA-Z0-9-]+$/;\nexport const tokenProviderTimeout = 30 * 1000; // 30 seconds (in ms)\n","import {\n  cacheExpiryTolerance,\n  tokenProviderTimeout,\n} from \"./constants\";\n\nimport { urlEncode, unixTimeNow } from \"./utils\";\n\nexport default class TokenProvider {\n  constructor({ authEndpoint, authData }) {\n    this.authEndpoint = authEndpoint;\n    this.authData = authData;\n  }\n\n  fetchToken() {\n    if (this.cacheIsStale) {\n      return this.makeAuthRequest().then(responseBody => {\n        this.cache(responseBody.access_token, responseBody.expires_in);\n        return this.cachedToken;\n      });\n    }\n    return Promise.resolve(this.cachedToken);\n  }\n\n  get cacheIsStale() {\n    return !this.cachedToken || unixTimeNow() > this.cacheValidUntil;\n  }\n\n  cache(token, expiresIn) {\n    this.cachedToken = token;\n    this.cacheValidUntil = unixTimeNow() + expiresIn - cacheExpiryTolerance;\n  }\n\n  makeAuthRequest() {\n    if (typeof this.authEndpoint != \"string\") {\n      throw new TypeError(`Expected authEndpoint to be a string, but got ${this.authEndpoint}. Please provide an authEndpoint to access private feeds. (See http://docs.pusher.com/feeds/concepts/private-feeds/)`);\n    }\n    return new Promise((resolve, reject) => {\n      const xhr = new XMLHttpRequest();\n      xhr.open(\"POST\", this.authEndpoint);\n      xhr.timeout = tokenProviderTimeout;\n      xhr.onload = () => {\n        if (xhr.status === 200) {\n          resolve(JSON.parse(xhr.responseText));\n        } else {\n          reject(new Error(`Couldn't fetch token from ${\n            this.authEndpoint\n          }; got ${ xhr.status } ${ xhr.statusText }.`));\n        }\n      };\n      xhr.ontimeout = () => {\n        reject(new Error(`Request timed out while fetching token from ${\n          this.authEndpoint\n        }`));\n      };\n      xhr.setRequestHeader(\"content-type\", \"application/x-www-form-urlencoded\");\n      xhr.send(urlEncode({\n        ...this.authData,\n        grant_type: \"client_credentials\",\n      }));\n    });\n  }\n}\n","import PusherPlatform from \"pusher-platform\";\nimport Feed from \"./feed\";\nimport TokenProvider from \"./token-provider\";\nimport { feedIdRegex } from \"./constants\";\nimport { parseResponse, queryString } from \"./utils\";\n\nexport default class Feeds {\n  constructor({\n    authData = {},\n    authEndpoint,\n    host,\n    instanceLocator,\n    logLevel,\n    logger,\n  } = {}) {\n    this.authData = authData;\n    this.authEndpoint = authEndpoint;\n    this.listTokenProvider = new TokenProvider({\n      authEndpoint: this.authEndpoint,\n      authData: {\n        ...this.authData,\n        path: \"feeds\",\n        action: \"READ\",\n      }\n    });\n    this.firehoseTokenProvider = new TokenProvider({\n      authEndpoint: this.authEndpoint,\n      authData: {\n        ...this.authData,\n        path: \"firehose/items\",\n        action: \"READ\",\n      }\n    });\n    if (!logger && logLevel) {\n      logger = new PusherPlatform.ConsoleLogger(logLevel);\n    }\n    this.instance = new PusherPlatform.Instance({\n      host,\n      locator: instanceLocator,\n      logger,\n      serviceName: \"feeds\",\n      serviceVersion: \"v1\",\n    });\n  }\n\n  list({ prefix, limit } = {}) {\n    return parseResponse(this.instance.request({\n      method: \"GET\",\n      path: \"feeds\" + queryString({ prefix, limit }),\n      tokenProvider: this.listTokenProvider,\n    }));\n  }\n\n  feed(feedId) {\n    if (!feedId || !feedId.match(feedIdRegex)) {\n      throw new TypeError(`Invalid feedId: ${ feedId }`);\n    }\n    const readTokenProvider =\n      feedId.startsWith(\"private-\") ? new TokenProvider({\n        authEndpoint: this.authEndpoint,\n        authData: {\n          ...this.authData,\n          path: `feeds/${ feedId }/items`,\n          action: \"READ\",\n        }\n      }) : null;\n    return new Feed({\n      instance: this.instance,\n      feedId,\n      readTokenProvider,\n    });\n  }\n\n  firehose({ onPublish, onSubscribe, onUnsubscribe, ...options } = {}) {\n    validateFirehoseCallbacks({ onPublish, onSubscribe, onUnsubscribe });\n    const onEvent = event => {\n      if (event.body.type === 0 && onPublish) {\n        onPublish(event.body.data);\n      } else if (event.body.type === 1 && onSubscribe) {\n        onSubscribe(event.body.data);\n      } else if (event.body.type === 2 && onUnsubscribe) {\n        onUnsubscribe(event.body.data);\n      } else if (event.body.type > 2) {\n        throw new TypeError(`Unsupported firehose event type '${\n          event.body.type\n        }'`);\n      }\n    };\n    return this.instance.subscribeNonResuming({\n      ...options,\n      path: \"firehose/items\",\n      tokenProvider: this.firehoseTokenProvider,\n      listeners: {\n        onEvent,\n        onOpen: options.onOpen,\n        onSubscribe: options.onSubscribe,\n        onError: options.onError,\n        onEnd: options.onEnd,\n      }\n    });\n  }\n}\n\nfunction validateFirehoseCallbacks(callbacks) {\n  const defined = Object.keys(callbacks)\n    .filter(k => callbacks[k] !== undefined)\n    .map(k => ({ name: k, callback: callbacks[k] }));\n  defined.forEach(({ name, callback }) => {\n    if (typeof callback !== \"function\") {\n      throw new TypeError(`${ name } must be a function, got ${ callback }`);\n    }\n  });\n  if (defined.length === 0) {\n    throw new TypeError(\"Must provide at least one of onPublish, onSubscribe, or onUnsubscribe\");\n  }\n}\n"],"names":["factory","modules","installedModules","__webpack_require__","moduleId","exports","module","i","l","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","responseToHeadersObject","headerStr","headers","_i","headerPairs_1","split","length","headerPair","index","indexOf","key","substring","val","value","ErrorResponse","statusCode","info","fromXHR","xhr","status","getAllResponseHeaders","responseText","XhrReadyState","NetworkError","error","LogLevel","ConsoleLogger","threshold","groups","Array","hr","window","console","group","label","push","log","groupEnd","pop","verbose","message","VERBOSE","debug","DEBUG","INFO","warn","WARNING","ERROR","logFunction","level","this","loggerSignature","EmptyLogger","network_1","createRetryStrategyOptionsOrDefault","options","initialTimeoutMillis","maxTimeoutMillis","limit","undefined","increaseTimeout","currentTimeout","Retry","waitTimeMillis","DoNotRetry","RetryResolution","logger","retryUnsafeRequests","currentRetryCount","increaseTimeoutFunction","currentBackoffMillis","attemptRetry","constructor","parseInt","method","toUpperCase","shouldSafeRetry","calulateMillisToRetry","logger_1","request_1","resuming_subscription_1","retrying_subscription_1","subscribe_strategy_1","subscription_1","token_providing_subscription_1","http_1","websocket_1","transports_1","BaseClient","host","replace","websocketTransport","default","httpTransport","request","tokenParams","_this","tokenProvider","fetchToken","then","token","_a","executeNetworkRequest","catch","subscribeResuming","path","listeners","retryStrategyOptions","initialEventId","completeListeners","replaceMissingListenersWithNoOps","subscribeStrategyListeners","subscribeStrategyListenersFromSubscriptionListeners","subscriptionStrategy","createResumingStrategy","createTokenProvidingStrategy","createTransportStrategy","opened","onEnd","onError","onEvent","onOpen","onSubscribe","onRetrying","subscribeNonResuming","createRetryingStrategy","createXhr","Promise","resolve","reject","onreadystatechange","readyState","response","send","JSON","stringify","body","retry_strategy_1","retryOptions","nextSubscribeStrategy","completeRetryOptions","retryResolution","ResumingSubscription","unsubscribe","state","onTransition","newState","OpeningSubscriptionState","lastEventId","underlyingSubscription","EndedSubscriptionState","ResumingSubscriptionState","event","eventId","OpenSubscriptionState","EndingSubscriptionState","executeSubscriptionOnce","errorResolution","timeout","setTimeout","FailedSubscriptionState","executeNextSubscribeStrategy","clearTimeout","Error","enrichedRetryOptions","RetryingSubscription","RetryingSubscriptionState","TokenProvidingSubscription","InactiveState","ActiveState","subscribe","existingListeners","assign","isTokenExpiredError","clearToken","putTokenIntoHeader","transport","base_client_1","instance_1","Instance","subListeners","HttpTransportState","HttpSubscription","gotEOS","lastNewlineIndex","UNOPENED","UNSENT","OPENED","HEADERS_RECEIVED","assertStateIsIn","OPENING","LOADING","onLoading","DONE","onDone","ENDED","abort","OPEN","ENDING","err","onChunk","newlineIndex","lastIndexOf","rawEvents","slice","rawEvents_1","rawEvent","data","parse","onMessage","validStates","arguments","some","validState","expectedStates","map","join","actualState","verifyMessage","onEventMessage","onEOSMessage","eventMessage","id","isArray","eosMessage","HttpTransport","encrypted","baseURL","requestOptions","createXHR","XMLHttpRequest","endpoint","open","setRequestHeader","jwt","__assign","t","WSReadyState","WsSubscriptions","subscriptions","add","subID","has","isEmpty","keys","remove","getAll","getAllAsArray","removeAll","WsSubscription","wsTransport","WebSocketTransport","webSocketPath","forcedClose","closedError","lastSubscriptionID","pendingSubscriptions","connect","tryReconnectIfNeeded","socket","Open","sendMessage","getMessage","subscription","close","WebSocket","onopen","forEach","subscribePending","pingInterval","setInterval","pongTimeout","now","Date","getTime","lastMessageReceivedTimestamp","lastSentPingID","onmessage","receiveMessage","onerror","onclose","callback","allSubscriptions","Closed","messageType","nonValidMessageError","validateMessage","shift","onPongMessage","onPingMessage","onCloseMessage","onOpenMessage","subscriptionListeners","closeMessage","receviedPongID","receviedPingID","locator","serviceName","serviceVersion","splitLocator","platformVersion","cluster","client","absPath","relativePath","parseResponse","promise","urlEncode","filter","encodeURIComponent","queryString","encodedData","unixTimeNow","Math","floor","Feed","instance","feedId","readTokenProvider","onItem","TypeError","lastItemId","previousItems","type","cursor","feedIdRegex","TokenProvider","authEndpoint","authData","cacheIsStale","makeAuthRequest","cache","responseBody","access_token","expires_in","cachedToken","expiresIn","cacheValidUntil","_this2","onload","statusText","ontimeout","instanceLocator","logLevel","listTokenProvider","firehoseTokenProvider","PusherPlatform","prefix","match","startsWith","onPublish","onUnsubscribe","callbacks","defined","k"],"mappings":"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"}